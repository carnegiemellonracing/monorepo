#include <CMR/can_types.h>
#include <CMR/can_ids.h>
#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>
#include <string.h>
#include <cn-cbor/cn-cbor.h>

static cn_cbor *msg;
static cn_cbor_errback err;

char bytes[] = {
0xA2,0x12,0x58,0x32,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x18,0x29,0x58,0xC8,0x0,0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,
0x0,0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,0x0,
0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,0x0,
0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,0x0,
0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,0x0,
0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,0x0,
0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,0x0,0xFC,0x86,0xFF,0xA2,0x12,0x58,0x32,0x0,
0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x18,0x29,0x58,0xC8,0x0
};

int main() {

    msg = cn_cbor_decode(bytes, sizeof(bytes), &err);

    /* Signal 42 in the current signal vector is the VSM's error vec,
     * try to parse and validate */
    cn_cbor *signal = cn_cbor_mapget_int(msg, 41);
    if (signal == NULL || signal->type != CN_CBOR_BYTES) {
        printf("Didn't find VSM messages in the parsed stream\n");
        exit(-1);
    }

    printf("All tests passed!\n");
    cn_cbor_free(msg);
    return 0;
}
